<p id='notice'><%= notice %></p>

<div class='col-xs-12 main-header'>
  <h1><span class='fa fa-cloud-download' aria-hidden='true'></span> Exporter: <%= @exporter.name %></h1>
</div>

<div class='panel panel-default'>
  <div class='panel-body'>

    <% if File.exist?(@exporter.exporter_export_zip_path) %>
      <p class='bulkrax-p-align'>
        <strong>Download:</strong>
        <%= link_to raw('<span class="glyphicon glyphicon-download"></span>'), exporter_download_path(@exporter) %>
      </p>
    <% end %>

    <p class='bulkrax-p-align'>
      <strong><%= t('bulkrax.exporter.labels.name') %>:</strong>
      <%= @exporter.name %>
    </p>

    <p class='bulkrax-p-align'>
      <strong><%= t('bulkrax.exporter.labels.user') %>:</strong>
      <%= @exporter.user %>
    </p>

    <p class='bulkrax-p-align'>
      <strong><%= t('bulkrax.exporter.labels.export_type') %>:</strong>
      <%= @exporter.export_type %>
    </p>

    <p class='bulkrax-p-align'>
      <strong><%= t('bulkrax.exporter.labels.export_from') %>:</strong>
      <%= @exporter.export_from %>
    </p>

    <p class='bulkrax-p-align'>
      <strong><%= t('bulkrax.exporter.labels.export_source') %>:</strong>
      <% case @exporter.export_from %>
      <% when 'collection' %>
        <% collection = Collection.find(@exporter.export_source) %>
        <%= link_to collection&.title&.first, hyrax.dashboard_collection_path(collection.id) %>
      <% when 'importer' %>
        <% importer = Bulkrax::Importer.find(@exporter.export_source) %>
        <%= link_to importer.name, bulkrax.importer_path(importer.id) %>
      <% when 'worktype' %>
        <%= @exporter.export_source %>
      <% end %>
    </p>

    <p class='bulkrax-p-align'>
      <strong><%= t('bulkrax.exporter.labels.parser_klass') %>:</strong>
      <%= @exporter.parser_klass %>
    </p>

    <p class='bulkrax-p-align'>
      <strong><%= t('bulkrax.exporter.labels.limit') %>:</strong>
      <%= @exporter.limit %>
    </p>

    <p class='bulkrax-p-align'>
      <strong><%= t('bulkrax.exporter.labels.generated_metadata') %>:</strong>
      <%= @exporter.generated_metadata %>
    </p>

    <p class='bulkrax-p-align'>
      <strong><%= t('bulkrax.exporter.labels.include_thumbnails') %>:</strong>
      <%= @exporter.include_thumbnails %>
    </p>


    <%= render partial: 'bulkrax/shared/bulkrax_errors', locals: {item: @exporter} %>

    <%= render partial: 'bulkrax/shared/bulkrax_field_mapping', locals: {item: @exporter} %>

    <%# Currently, no parser-specific fields exist on Exporter,
        thus there's no real reason to always show this field %>
    <% if @exporter.parser_fields.present? %>
      <p class='bulkrax-p-align'>
        <strong><%= t('bulkrax.exporter.labels.parser_fields') %>:</strong><br>
        <% @exporter.parser_fields.each do |k, v| %>
          <%= k %>: <%= v %><br>
        <% end %>
      </p>
    <% end %>

    <p class='bulkrax-p-align'><strong><%= t('bulkrax.exporter.labels.field_mapping') %>:</strong></p>

    <p class="bulkrax-p-align" title="<%= @exporter.last_run&.total_work_entries %> processed, <%= @exporter.last_run&.failed_records %> failed">
      <strong>Total Entries:</strong>
      <%= @exporter.last_run&.total_work_entries %>
    </p>
    <br>

    <div class="bulkrax-nav-tab-bottom-margin">
      <!-- Nav tabs -->
      <ul class="bulkrax-nav-tab-top-margin tab-nav nav nav-tabs" role="tablist">
        <li role="presentation" class='active'><a href="#work-entries" aria-controls="work-entries" role="tab" data-toggle="tab">Work Entries</a></li>
        <li role="presentation"><a href="#collection-entries" aria-controls="collection-entries" role="tab" data-toggle="tab">Collection Entries</a></li>
        <li role="presentation"><a href="#file-set-entries" aria-controls="file-set-entries" role="tab" data-toggle="tab">File Set Entries</a></li>
      </ul>
      <!-- Tab panes -->
      <div class="tab-content outline">
        <div role="tabpanel" class="tab-pane active bulkrax-nav-tab-table-left-align" id="work-entries">
          <table class='table table-striped'>
            <thead>
              <tr>
                <th>Identifier</th>
                <th>Entry ID</th>
                <th>Status</th>
                <th>Errors</th>
                <th>Status Set At</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @work_entries.each do |e| %>
                <tr>
                  <td><%= link_to e.identifier, bulkrax.exporter_entry_path(@exporter.id, e.id) %></td>
                  <td><%= e.id %></td>
                  <% if e.status == "Complete" %>
                    <td><span class="glyphicon glyphicon-ok" style="color: green;"></span> <%= e.status %></td>
                  <% elsif e.status == "Pending" %>
                    <td><span class="glyphicon glyphicon-option-horizontal" style="color: blue;"></span> <%= e.status %></td>
                  <% else %>
                    <td><span class="glyphicon glyphicon-remove" style="color: <%= e.status == 'Deleted' ? 'green' : 'red' %>;"></span> <%= e.status %></td>
                  <% end %>
                  <% if e.last_error.present? %>
                    <td><%= link_to e.last_error.dig("error_class"), bulkrax.exporter_entry_path(@exporter.id, e.id) %></td>
                  <% else %>
                    <td></td>
                  <% end %>
                  <td><%= e.status_at %></td>
                  <td><%= link_to raw('<span class="glyphicon glyphicon-info-sign"></span>'), bulkrax.exporter_entry_path(@exporter.id, e.id) %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
          <%= page_entries_info(@work_entries) %><br />
          <%= paginate(@work_entries, theme: 'blacklight', param_name: :work_entries_page, params: { anchor: 'work-entries'}) %>
        </div>
        <div role="tabpanel" class="tab-pane bulkrax-nav-tab-table-left-align" id="collection-entries">
          <table class='table table-striped'>
            <thead>
              <tr>
                <th>Identifier</th>
                <th>Entry ID</th>
                <th>Status</th>
                <th>Errors</th>
                <th>Status Set At</th>
                <th>Actions</th>
              </tr>
            </thead>
            <%
=begin%>
 <tbody>
              <% @collection_entries.each do |e| %>
                <tr>
                  <td><%= link_to e.identifier, bulkrax.exporter_entry_path(@exporter.id, e.id) %></td>
                  <td><%= e.id %></td>
                  <% if e.status == "Complete" %>
                    <td><span class="glyphicon glyphicon-ok" style="color: green;"></span> <%= e.status %></td>
                  <% elsif e.status == "Pending" %>
                    <td><span class="glyphicon glyphicon-option-horizontal" style="color: blue;"></span> <%= e.status %></td>
                  <% else %>
                    <td><span class="glyphicon glyphicon-remove" style="color: <%= e.status == 'Deleted' ? 'green' : 'red' %>;"></span> <%= e.status %></td>
                  <% end %>
                  <% if e.last_error.present? %>
                    <td><%= link_to e.last_error.dig("error_class"), bulkrax.exporter_entry_path(@exporter.id, e.id) %></td>
                  <% else %>
                    <td></td>
                  <% end %>
                  <td><%= e.status_at %></td>
                  <td><%= link_to raw('<span class="glyphicon glyphicon-info-sign"></span>'), bulkrax.exporter_entry_path(@exporter.id, e.id) %></td>
                </tr>
              <% end %>
            </tbody>
<%
=end%>
          </table>
          <%
=begin%>
 <%= page_entries_info(@collection_entries) %><br />
          <%= paginate(@collection_entries, theme: 'blacklight', param_name: :collections_entries_page, params: {anchor: 'collection-entries'}) %>
<%
=end%>
        </div>
        <div role="tabpanel" class="tab-pane bulkrax-nav-tab-table-left-align" id="file-set-entries">
          <table class='table table-striped'>
            <thead>
              <tr>
                <th>Identifier</th>
                <th>Entry ID</th>
                <th>Status</th>
                <th>Errors</th>
                <th>Status Set At</th>
                <th>Actions</th>
              </tr>
            </thead>
            <%
=begin%>
 <tbody>
              <% @file_set_entries.each do |e| %>
                <tr>
                  <td><%= link_to e.identifier, bulkrax.exporter_entry_path(@exporter.id, e.id) %></td>
                  <td><%= e.id %></td>
                  <% if e.status == "Complete" %>
                    <td><span class="glyphicon glyphicon-ok" style="color: green;"></span> <%= e.status %></td>
                  <% elsif e.status == "Pending" %>
                    <td><span class="glyphicon glyphicon-option-horizontal" style="color: blue;"></span> <%= e.status %></td>
                  <% else %>
                    <td><span class="glyphicon glyphicon-remove" style="color: <%= e.status == 'Deleted' ? 'green' : 'red' %>;"></span> <%= e.status %></td>
                  <% end %>
                  <% if e.last_error.present? %>
                    <td><%= link_to e.last_error.dig("error_class"), bulkrax.exporter_entry_path(@exporter.id, e.id) %></td>
                  <% else %>
                    <td></td>
                  <% end %>
                  <td><%= e.status_at %></td>
                  <td><%= link_to raw('<span class="glyphicon glyphicon-info-sign"></span>'), bulkrax.exporter_entry_path(@exporter.id, e.id) %></td>
                </tr>
              <% end %>
            </tbody>
<%
=end%>
          </table>
          <%
=begin%>
 <%= page_entries_info(@file_set_entries) %><br />
          <%= paginate(@file_set_entries, theme: 'blacklight', param_name: :file_set_entries_page, params: {anchor: 'file-set-entries'}) %>
<%
=end%>
        </div>
      </div>
    </div>
  </div>
</div>
